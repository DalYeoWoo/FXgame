<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>FXGAME</title>

    <style>
        body {padding:50px;}
        
    </style>

    <script>
        var time = 0;
        var set = 0;
        var rate = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21];
        var hist = '';
        var money = 100000000;
        var choice = "NONE";
        var answer = ["UP","DOWN","UP","DOWN","UP","DOWN","UP","DOWN","UP","DOWN"]

        function startInterval() {
            setInterval(updateTime, 1000);
        }

        startInterval();        

        function updateTime() {
            if (time ==1){
                hist += choice+'/';

                if (choice == answer[set]){ 
                    money *= 1.3;
                }
                else if (choice == "NONE"){
                    money *= 1;
                }
                else{
                    money *= 0.8;
                }
                document.getElementById('money').innerHTML = money+"원";


                if(set==9){

                    document.getElementById('submit').innerHTML="<form action=\"{% url 'polls:submit' participant.id %}\" method=\"post\"\"> <input type = \"submit\" value=\"설문조사 제출하기\"><input name='hist' value='"+hist+"'></form>";
                }

                set += 1;
                time = 0;
                choice = "NONE";
                document.getElementById('initial_rate').innerHTML = "초기 환율: "+rate[time+(set)*20];
                document.getElementById('history').innerHTML = hist;
            } 

            time += 1;

            document.getElementById('set').innerHTML = "set "+(set+1);
            document.getElementById('time').innerHTML = time + "초";
            document.getElementById('rate').innerHTML = rate[time+(set)*20];
        }

        function up(){
            if (time < 13){
                choice = "UP";
            }
            else{
                window.alert("선택지를 바꿀 수 없습니다");
            }
        }

        function down(){
            if (time < 13){
                choice = "DOWN";
            }
            else{
                window.alert("선택지를 바꿀 수 없습니다");
            }
        }

       
    </script>

<script>
    window.onload = function () {
    var dps = []; // dataPoints
    var chart = new CanvasJS.Chart("chartContainer", {
        title :{
            text: "USD TO KRW Currency"
        },
        data: [{
            type: "line",
            dataPoints: dps
        }]
    });
    var xVal = 0;
    var xSet=0;
    var yflow = [0,1,2,3,4,5,6,7,8,9,10];
    var yVal = yflow[0]; 
    var updateInterval = 1000;
    var dataLength = 20;
    var updateChart = function (count) {
        count = count || 1;
        for (var j = 0; j < count; j++) {
            yVal = yflow[xVal+xSet*20];
            dps.push({
                x: xVal,
                y: yVal
            });
            xVal++;
            if(xVal==21){xVal=0;xSet++;}
        }
        if (dps.length > dataLength) {
            dps.shift();
        }
        chart.render();
    };
    updateChart(1);
    setInterval(function(){updateChart()}, updateInterval);
    }
    </script>

</head>
<body>
<h1>GROUP: {{ participant.group}}</h1>
{% if error_message %}
<p>{{ error_message }}</p>
{% endif %}

<p id="set">set 1</p>
<p id="time">0초</p>
<div id="chartContainer" style="height: 300px; width: 500px;"></div>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<p id="initial_rate">초기 환율: 1.1</p>
<p id="rate"></p>

<p id="money">가진 돈: 1억원</p>


<!--그룹 별 차이-->
{% if participant.group == 'A' %}
<p> 아아 당신은 운좋은 사람 </p>
{% endif %}

<!--상승/하락-->
<input type="button" value="상승" onclick="up()"/>
<input type="button" value="하락" onclick="down()"/>

<p id="history"></p>

<div id="submit"></div>

</body>
</html>